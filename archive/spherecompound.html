<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Test Tube Calculator (Cylinder + Hemisphere)</title>

<style>
:root{--ink:#000;--line:#cfcfcf;--muted:#666;--blue:#2563eb;--orange:#f97316}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#fff;color:var(--ink)}
.wrap{max-width:1000px;margin:6px auto;padding:0 6px}
.card{border:1px solid var(--line);border-radius:10px;padding:12px}

.controls-row{display:flex;flex-wrap:wrap;gap:8px;align-items:start;margin-bottom:12px}
.block{border:1px solid var(--line);border-radius:8px;padding:8px}
.block h3{margin:0 0 4px;font-size:12px}

.shape-block{min-width:160px}
.shape-title{font-family:"Times New Roman",Times,serif;font-size:20px;font-weight:700}
.shape-sub{font-size:11px;color:var(--muted);margin-top:2px}

.input-block{display:flex;align-items:center;gap:10px;padding:8px 12px}
.input-block h3{margin:0;font-size:12px;min-width:80px}
.value-input{width:80px;border:2px solid var(--blue);border-radius:6px;padding:6px 8px;font-size:18px;text-align:center;font-family:"Times New Roman",Times,serif;font-weight:bold}
.value-input:focus{outline:none;border-color:#000}
.input-display{font-family:"Times New Roman",Times,serif;font-size:16px}

.btnrow{display:grid;grid-template-columns:repeat(5,1fr);gap:3px}
.btnrow button{border:1px solid var(--line);border-radius:5px;background:#fff;font-size:11px;padding:5px 3px;cursor:pointer}
.btnrow button.active{background:#000;color:#fff}

.reveal-btn{border:2px solid var(--line);border-radius:6px;background:#fff;font-size:14px;padding:10px 20px;cursor:pointer;font-weight:bold}
.reveal-btn:hover{background:#f5f5f5}

.main{display:grid;grid-template-columns:180px 1fr 1fr;gap:12px;align-items:start}

.diagram svg{width:100%;height:auto;display:block}

.calc{border:1px solid var(--line);border-radius:8px;padding:12px;transition:filter 0.3s ease}
.calc.hidden{filter:blur(5px)}
.calc h2{margin:0 0 8px;font-size:14px;color:var(--orange);font-family:"Times New Roman",Times,serif;font-style:italic}
.line{font-family:"Times New Roman",Times,serif;font-size:16px;margin:5px 0}
.line.indent{margin-left:20px}

.answer-container{margin:10px 0}
.answer-box{display:inline-block;border:2px solid #000;padding:8px 14px;font-family:"Times New Roman",Times,serif;font-size:18px}

.calc-box{border:1px solid var(--line);border-radius:6px;padding:10px;margin:8px 0;background:#fefefe}
.calc-box h3{margin:0 0 6px;font-size:13px;color:var(--muted)}

.total-box{background:#fff7ed;border:2px solid var(--orange);border-radius:8px;padding:12px;margin-top:12px}
.total-box .line{font-size:18px}

.frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;margin:0 2px}
.frac-num{border-bottom:2px solid #000;padding:0 3px 1px;font-size:0.85em}
.frac-den{padding:1px 3px 0;font-size:0.85em}

@media(max-width:750px){
  .main{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div class="wrap">
<section class="card">

<div class="controls-row">
  <div class="block shape-block">
    <div class="shape-title">Test Tube</div>
    <div class="shape-sub">Cylinder + Hemisphere</div>
  </div>
  
  <div class="block input-block">
    <h3>Diameter</h3>
    <input type="number" class="value-input" id="diameterInput" min="0" step="0.5" value="7">
    <div class="input-display" id="diameterDisplay"><i>d</i> = 7</div>
  </div>
  
  <div class="block input-block">
    <h3>Total Length</h3>
    <input type="number" class="value-input" id="lengthInput" min="0" step="0.5" value="13.5">
    <div class="input-display" id="lengthDisplay"><i>L</i> = 13.5</div>
  </div>
  
  <div class="block">
    <h3>Units</h3>
    <div class="btnrow" id="unitBtns"></div>
  </div>
  
  <button class="reveal-btn" id="revealBtn">Reveal</button>
</div>

<div class="main">
  <div class="diagram-area">
    <div class="diagram">
      <svg viewBox="0 0 160 280" aria-label="Test tube diagram">
        <defs>
          <linearGradient id="tubeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#fecaca"/>
            <stop offset="50%" style="stop-color:#fee2e2"/>
            <stop offset="100%" style="stop-color:#fecaca"/>
          </linearGradient>
        </defs>
        <!-- Cylinder body -->
        <rect x="30" y="30" width="100" height="180" fill="url(#tubeGrad)" stroke="#000" stroke-width="2"/>
        <!-- Top ellipse -->
        <ellipse cx="80" cy="30" rx="50" ry="12" fill="#fee2e2" stroke="#000" stroke-width="2"/>
        <!-- Hemisphere bottom -->
        <path d="M 30 210 Q 30 260 80 260 Q 130 260 130 210" fill="url(#tubeGrad)" stroke="#000" stroke-width="2"/>
        <!-- Dashed line at join -->
        <ellipse cx="80" cy="210" rx="50" ry="12" fill="none" stroke="#000" stroke-width="1.5" stroke-dasharray="5,4"/>
        
        <!-- Diameter arrow -->
        <line x1="30" y1="15" x2="130" y2="15" stroke="#c00" stroke-width="1.5"/>
        <polygon points="30,15 38,12 38,18" fill="#c00"/>
        <polygon points="130,15 122,12 122,18" fill="#c00"/>
        <text id="dLabel" x="80" y="10" font-size="12" font-family="Times New Roman" text-anchor="middle" fill="#c00">7 cm</text>
        
        <!-- Total length arrow -->
        <line x1="145" y1="30" x2="145" y2="260" stroke="#c00" stroke-width="1.5"/>
        <polygon points="145,30 142,38 148,38" fill="#c00"/>
        <polygon points="145,260 142,252 148,252" fill="#c00"/>
        <text id="LLabel" x="150" y="145" font-size="12" font-family="Times New Roman" fill="#c00" writing-mode="vertical-rl">13.5 cm</text>
      </svg>
    </div>
  </div>

  <div class="calc" id="partACalc">
    <h2>(a) Height of cylindrical part</h2>
    <div class="line">Diameter = <span id="dVal">7</span> cm</div>
    <div class="line">∴ Radius = <span id="dVal2">7</span> ÷ 2 = <span id="rVal">3.5</span> cm</div>
    <div class="line" style="margin-top:10px">Height of cylinder = Total length − radius</div>
    <div class="line indent">= <span id="LVal">13.5</span> − <span id="rVal2">3.5</span></div>
    <div class="answer-container">
      <div class="answer-box" id="hAns">= 10 cm</div>
    </div>
  </div>

  <div class="calc" id="partBCalc">
    <h2>(b) Total volume in terms of π</h2>
    <div class="line">Test tube = cylinder + hemisphere</div>
    
    <div class="calc-box">
      <h3>Volume of cylinder = π<i>r</i>²<i>h</i></h3>
      <div class="line" id="cylS1"></div>
      <div class="answer-container">
        <div class="answer-box" id="cylAns"></div>
      </div>
    </div>
    
    <div class="calc-box">
      <h3>Volume of hemisphere = <span class="frac"><span class="frac-num">2</span><span class="frac-den">3</span></span>π<i>r</i>³</h3>
      <div class="line" id="hemiS1"></div>
      <div class="answer-container">
        <div class="answer-box" id="hemiAns"></div>
      </div>
    </div>
    
    <div class="total-box">
      <div class="line">∴ Total volume = <span id="cylCoef"></span>π + <span id="hemiCoef"></span>π</div>
      <div class="answer-container">
        <div class="answer-box" id="totalAns"></div>
      </div>
    </div>
  </div>
</div>

</section>
</div>

<script>
let diameter = 7;
let totalLength = 13.5;
let unit = null;
let answersVisible = false;

const units = [
  {symbol:'cm', name:'centimetre'},
  {symbol:'mm', name:'millimetre'},
  {symbol:'m', name:'metre'},
  {symbol:'km', name:'kilometre'},
  {symbol:'', name:'units'}
];

const diameterInput = document.getElementById("diameterInput");
const lengthInput = document.getElementById("lengthInput");
const revealBtn = document.getElementById("revealBtn");
const partACalc = document.getElementById("partACalc");
const partBCalc = document.getElementById("partBCalc");

diameterInput.addEventListener("input", () => {
  let val = parseFloat(diameterInput.value);
  if (!isNaN(val) && val >= 0) { diameter = val; update(); }
});
diameterInput.addEventListener("change", () => {
  let val = parseFloat(diameterInput.value);
  if (isNaN(val) || val < 0) val = 7;
  diameter = val;
  diameterInput.value = diameter;
  update();
});

lengthInput.addEventListener("input", () => {
  let val = parseFloat(lengthInput.value);
  if (!isNaN(val) && val >= 0) { totalLength = val; update(); }
});
lengthInput.addEventListener("change", () => {
  let val = parseFloat(lengthInput.value);
  if (isNaN(val) || val < 0) val = 13.5;
  totalLength = val;
  lengthInput.value = totalLength;
  update();
});

revealBtn.addEventListener("click", () => {
  answersVisible = !answersVisible;
  if (answersVisible) {
    revealBtn.textContent = "Hide";
    partACalc.classList.remove("hidden");
    partBCalc.classList.remove("hidden");
  } else {
    revealBtn.textContent = "Reveal";
    partACalc.classList.add("hidden");
    partBCalc.classList.add("hidden");
  }
});

const unitWrap = document.getElementById("unitBtns");
units.forEach((u, idx) => {
  const b = document.createElement("button");
  b.textContent = u.symbol || 'units';
  b.title = u.name;
  if (idx === 0) b.classList.add("active");
  b.onclick = () => {
    document.querySelectorAll("#unitBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    unit = u;
    update();
  };
  unitWrap.appendChild(b);
});

// GCD for simplifying fractions
function gcd(a, b) {
  a = Math.abs(Math.round(a * 1000000));
  b = Math.abs(Math.round(b * 1000000));
  while (b) { let t = b; b = a % b; a = t; }
  return a / 1000000;
}

// Convert decimal to fraction object {num, den}
function toFraction(decimal, maxDen = 1000) {
  if (Number.isInteger(decimal)) return {num: decimal, den: 1};
  
  let bestNum = Math.round(decimal);
  let bestDen = 1;
  let bestErr = Math.abs(decimal - bestNum);
  
  for (let den = 2; den <= maxDen; den++) {
    let num = Math.round(decimal * den);
    let err = Math.abs(decimal - num/den);
    if (err < bestErr) {
      bestErr = err;
      bestNum = num;
      bestDen = den;
      if (err < 1e-9) break;
    }
  }
  
  const g = gcd(bestNum, bestDen) * 1000000;
  return {num: Math.round(bestNum * 1000000 / g), den: Math.round(bestDen * 1000000 / g)};
}

// Format mixed fraction HTML
function mixedFracHTML(decimal) {
  if (Number.isInteger(decimal)) return String(decimal);
  
  const frac = toFraction(decimal);
  if (frac.den === 1) return String(frac.num);
  
  const whole = Math.floor(frac.num / frac.den);
  const remainder = frac.num % frac.den;
  
  if (remainder === 0) return String(whole);
  if (whole > 0) {
    return `${whole}<span class="frac"><span class="frac-num">${remainder}</span><span class="frac-den">${frac.den}</span></span>`;
  }
  return `<span class="frac"><span class="frac-num">${frac.num}</span><span class="frac-den">${frac.den}</span></span>`;
}

function fmt(n) {
  if (Number.isInteger(n)) return String(n);
  // Check if it's close to a nice decimal
  const rounded = Math.round(n * 100) / 100;
  if (Math.abs(n - rounded) < 1e-9) {
    return rounded % 1 === 0 ? String(rounded) : rounded.toFixed(1).replace(/\.0$/, '');
  }
  return n.toFixed(2);
}

function update() {
  const unitStr = unit && unit.symbol ? ' ' + unit.symbol : '';
  const unitStr3 = unit && unit.symbol ? ' ' + unit.symbol + '³' : '';

  const r = diameter / 2;
  const h = totalLength - r;
  
  // Update displays
  document.getElementById("diameterDisplay").innerHTML = `<i>d</i> = ${fmt(diameter)}${unitStr}`;
  document.getElementById("lengthDisplay").innerHTML = `<i>L</i> = ${fmt(totalLength)}${unitStr}`;
  document.getElementById("dLabel").textContent = fmt(diameter) + unitStr;
  document.getElementById("LLabel").textContent = fmt(totalLength) + unitStr;
  
  // Part (a)
  document.getElementById("dVal").textContent = fmt(diameter);
  document.getElementById("dVal2").textContent = fmt(diameter);
  document.getElementById("rVal").textContent = fmt(r);
  document.getElementById("LVal").textContent = fmt(totalLength);
  document.getElementById("rVal2").textContent = fmt(r);
  document.getElementById("hAns").innerHTML = `= ${fmt(h)}${unitStr}`;
  
  // Part (b) - Volumes in terms of π
  // Cylinder: πr²h
  const cylCoef = r * r * h;
  // Hemisphere: (2/3)πr³
  const hemiCoef = (2/3) * r * r * r;
  // Total
  const totalCoef = cylCoef + hemiCoef;
  
  document.getElementById("cylS1").innerHTML = `= π × (${fmt(r)})² × ${fmt(h)}`;
  document.getElementById("cylAns").innerHTML = `= ${mixedFracHTML(cylCoef)}π${unitStr3}`;
  
  document.getElementById("hemiS1").innerHTML = `= <span class="frac"><span class="frac-num">2</span><span class="frac-den">3</span></span> × π × (${fmt(r)})³`;
  document.getElementById("hemiAns").innerHTML = `= ${mixedFracHTML(hemiCoef)}π${unitStr3}`;
  
  document.getElementById("cylCoef").innerHTML = mixedFracHTML(cylCoef);
  document.getElementById("hemiCoef").innerHTML = mixedFracHTML(hemiCoef);
  document.getElementById("totalAns").innerHTML = `= ${mixedFracHTML(totalCoef)}π${unitStr3}`;
}

unit = units[0];
update();
</script>
</body>
</html>
