<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sphere Calculator</title>

<style>
:root{--ink:#000;--line:#cfcfcf;--muted:#666;--blue:#2563eb}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#fff;color:var(--ink)}
.wrap{max-width:900px;margin:6px auto;padding:0 6px}
.card{border:1px solid var(--line);border-radius:10px;padding:12px}

.controls-row{display:flex;flex-wrap:wrap;gap:8px;align-items:start;margin-bottom:12px}
.block{border:1px solid var(--line);border-radius:8px;padding:8px}
.block h3{margin:0 0 4px;font-size:12px}

.shape-block{min-width:140px}
.shape-title{font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:700}
.shape-sub{font-size:11px;color:var(--muted);margin-top:2px}

.input-block{display:flex;align-items:center;gap:10px;padding:8px 14px}
.input-block h3{margin:0;font-size:13px;min-width:60px}
.input-container{display:flex;align-items:center;gap:4px}
.value-input{width:80px;border:2px solid var(--blue);border-radius:6px;padding:6px 8px;font-size:20px;text-align:center;font-family:"Times New Roman",Times,serif;font-weight:bold}
.value-input:focus{outline:none;border-color:#000}
.arrow-buttons{display:flex;flex-direction:column;gap:2px}
.arrow-btn{width:30px;height:24px;border:2px solid var(--line);border-radius:4px;background:#fff;cursor:pointer;font-size:16px;font-weight:bold;display:flex;align-items:center;justify-content:center;user-select:none}
.arrow-btn:hover{background:#f0f0f0}
.arrow-btn:active{background:#e0e0e0}
.input-display{font-family:"Times New Roman",Times,serif;font-size:18px}

.dprow{display:flex;gap:4px}
.dprow button{flex:1;border:1px solid var(--line);border-radius:6px;background:#fff;font-size:12px;padding:6px 10px;cursor:pointer}
.dprow button.active{background:#000;color:#fff}

.btnrow{display:grid;grid-template-columns:repeat(5,1fr);gap:3px}
.btnrow button{border:1px solid var(--line);border-radius:5px;background:#fff;font-size:11px;padding:5px 3px;cursor:pointer}
.btnrow button.active{background:#000;color:#fff}

.reveal-btn-small{border:2px solid var(--line);border-radius:6px;background:#fff;font-size:16px;padding:8px 20px;cursor:pointer;margin-top:6px;font-weight:600;margin-right:6px}
.reveal-btn-small:hover{background:#f5f5f5}

.button-row{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}

.main{display:grid;grid-template-columns:180px 1fr;gap:12px;align-items:start}

.diagram svg{width:100%;height:auto;display:block}

.calc-section{display:flex;flex-direction:column}
.formula-header{text-align:center;margin-bottom:8px}
.formula-large{font-family:"Times New Roman",Times,serif;font-size:32px;font-weight:bold}
.formula-label{font-size:18px;color:var(--muted);margin-top:2px;font-weight:600}
.formula-meta{font-size:16px;color:var(--muted);margin-top:4px;font-family:Segoe UI,Arial,sans-serif}

.calc{border:1px solid var(--line);border-radius:8px;padding:12px}
.work-line{display:flex;justify-content:space-between;align-items:center;margin:8px 0;min-height:30px}
.math-content{font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:bold;flex:1}
.logic-hint{font-family:Segoe UI,Arial,sans-serif;font-size:18px;color:var(--blue);font-style:italic;font-weight:600;margin-left:20px;white-space:nowrap}

.answer-container{margin:10px 0}
.answer-box{display:inline-block;border:2px solid #000;padding:8px 14px;font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:bold}
.answer-box .label{font-style:italic}

.round-arrow{font-size:20px;font-weight:bold}
.round-up{color:#16a34a}
.round-down{color:#dc2626}

.frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;margin:0 2px}
.frac-num{border-bottom:2px solid #000;padding:0 3px 1px;font-size:0.85em}
.frac-den{padding:1px 3px 0;font-size:0.85em}

.blurred{filter:blur(5px)}

@media(max-width:700px){
  .main{grid-template-columns:1fr}
  .formula-large{font-size:28px}
}
</style>
</head>

<body>
<div class="wrap">
<section class="card">

<div class="controls-row">
  <div class="block shape-block">
    <div class="shape-title">Sphere</div>
    <div class="shape-sub">3D solid (ball)</div>
  </div>
  
  <div class="block input-block">
    <h3>Radius</h3>
    <div class="input-container">
      <input type="number" class="value-input" id="radiusInput" min="0" step="1" value="7">
      <div class="arrow-buttons">
        <button class="arrow-btn" id="radiusUp">▲</button>
        <button class="arrow-btn" id="radiusDown">▼</button>
      </div>
    </div>
    <div class="input-display" id="radiusDisplay"><i>r</i> = 7</div>
  </div>
  
  <div class="block">
    <h3>Value of π</h3>
    <div class="dprow" id="piBtns"></div>
  </div>
  
  <div class="block">
    <h3>Decimal places</h3>
    <div class="dprow" id="dpBtns"></div>
  </div>
  
  <div class="block">
    <h3>Units</h3>
    <div class="btnrow" id="unitBtns"></div>
  </div>
</div>

<div class="main">
  <div class="diagram-area">
    <div class="diagram">
      <svg viewBox="0 0 200 220" aria-label="Sphere diagram">
        <defs>
          <radialGradient id="sphereGrad">
            <stop offset="0%" style="stop-color:#f9fafb"/>
            <stop offset="70%" style="stop-color:#e5e7eb"/>
            <stop offset="100%" style="stop-color:#d1d5db"/>
          </radialGradient>
          <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="5" markerHeight="5" orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#000"/>
          </marker>
        </defs>
        
        <circle cx="100" cy="110" r="70" fill="url(#sphereGrad)" stroke="#000" stroke-width="2"/>
        <path d="M 30 110 A 70 20 0 0 1 170 110" fill="none" stroke="#000" stroke-width="1.5" stroke-dasharray="4,3"/>
        <path d="M 170 110 A 70 20 0 0 1 30 110" fill="none" stroke="#000" stroke-width="1.5"/>
        <line x1="100" y1="110" x2="168" y2="110" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>
        <text id="rLabel" x="130" y="100" font-size="16" font-family="Times New Roman" font-style="italic">r</text>
      </svg>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div class="calc-section">
    <div class="formula-header">
      <div class="formula-label">Surface Area (SA)</div>
      <div class="formula-meta" id="aMetaWords"></div>
      <div class="formula-large"><i>A</i> = 4π<i>r</i>²</div>
      <div class="formula-meta" id="aMeta"></div>
      <div class="button-row">
        <button class="reveal-btn-small" id="hideA">Hide</button>
        <button class="reveal-btn-small" id="showA" style="display:none;">Show</button>
        <button class="reveal-btn-small" id="stepA" style="display:none;">Step by Step</button>
        <button class="reveal-btn-small" id="nextA" style="display:none;">Next</button>
      </div>
    </div>
    <div class="calc" id="areaCalc">
      <div class="work-line" id="aLine0">
        <div class="math-content" id="aFormula"></div>
        <div class="logic-hint">Formula</div>
      </div>
      <div class="work-line" id="aLine1">
        <div class="math-content" id="aS1"></div>
        <div class="logic-hint">Substitution</div>
      </div>
      <div class="work-line" id="aLine2">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="aE"></div>
        </div>
        <div class="logic-hint">Simplify</div>
      </div>
      <div class="work-line" id="aLine3">
        <div class="math-content" id="aTrunc"></div>
        <div class="logic-hint" id="aTruncHint">Truncate (dp+1)</div>
      </div>
      <div class="work-line" id="aLine4">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="aN"></div>
        </div>
        <div class="logic-hint" id="aRound"></div>
      </div>
    </div>
  </div>

  <div class="calc-section">
    <div class="formula-header">
      <div class="formula-label">Volume (V)</div>
      <div class="formula-meta" id="vMetaWords"></div>
      <div class="formula-large"><i>V</i> = <span class="frac"><span class="frac-num">4π<i>r</i>³</span><span class="frac-den">3</span></span></div>
      <div class="formula-meta" id="vMeta"></div>
      <div class="button-row">
        <button class="reveal-btn-small" id="hideV">Hide</button>
        <button class="reveal-btn-small" id="showV" style="display:none;">Show</button>
        <button class="reveal-btn-small" id="stepV" style="display:none;">Step by Step</button>
        <button class="reveal-btn-small" id="nextV" style="display:none;">Next</button>
      </div>
    </div>
    <div class="calc" id="volumeCalc">
      <div class="work-line" id="vLine0">
        <div class="math-content" id="vFormula"></div>
        <div class="logic-hint">Formula</div>
      </div>
      <div class="work-line" id="vLine1">
        <div class="math-content" id="vS1"></div>
        <div class="logic-hint">Substitution</div>
      </div>
      <div class="work-line" id="vLine2">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="vE"></div>
        </div>
        <div class="logic-hint">Simplify</div>
      </div>
      <div class="work-line" id="vLine3">
        <div class="math-content" id="vTrunc"></div>
        <div class="logic-hint" id="vTruncHint">Truncate (dp+1)</div>
      </div>
      <div class="work-line" id="vLine4">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="vN"></div>
        </div>
        <div class="logic-hint" id="vRound"></div>
      </div>
    </div>
  </div>
</div>

</section>
</div>

<script>
let r = 7;
let dp = 2;
let unit = null;
let piMode = 'exact';

const units = [
  {symbol:'u', name:'unit'},
  {symbol:'mm', name:'millimetre'},
  {symbol:'cm', name:'centimetre'},
  {symbol:'m', name:'metre'},
  {symbol:'km', name:'kilometre'}
];

const radiusInput = document.getElementById("radiusInput");
const radiusUp = document.getElementById("radiusUp");
const radiusDown = document.getElementById("radiusDown");

radiusUp.addEventListener("click", () => {
  r = r + 1;
  radiusInput.value = r;
  update();
});

radiusDown.addEventListener("click", () => {
  r = Math.max(0, r - 1);
  radiusInput.value = r;
  update();
});

radiusInput.addEventListener("input", () => {
  let val = parseFloat(radiusInput.value);
  if (!isNaN(val) && val >= 0) { r = val; update(); }
});

radiusInput.addEventListener("change", () => {
  let val = parseFloat(radiusInput.value);
  if (isNaN(val) || val < 0) val = 7;
  r = val; radiusInput.value = r; update();
});

const dpWrap = document.getElementById("dpBtns");
[1,2,3,4].forEach(v => {
  const b = document.createElement("button");
  b.textContent = v;
  if (v === 2) b.classList.add("active");
  b.onclick = () => {
    document.querySelectorAll("#dpBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    dp = v;
    update();
  };
  dpWrap.appendChild(b);
});

const piWrap = document.getElementById("piBtns");
[{mode:'exact', label:'π'}, {mode:'22/7', label:'²²⁄₇'}, {mode:'3.14', label:'3.14'}].forEach((p, idx) => {
  const b = document.createElement("button");
  b.textContent = p.label;
  if (idx === 0) b.classList.add("active");
  b.onclick = () => {
    document.querySelectorAll("#piBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    piMode = p.mode;
    update();
  };
  piWrap.appendChild(b);
});

const unitWrap = document.getElementById("unitBtns");
units.forEach((u, idx) => {
  const b = document.createElement("button");
  b.textContent = u.symbol;
  b.title = u.name;
  if (idx === 0) b.classList.add("active");
  b.onclick = () => {
    document.querySelectorAll("#unitBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    unit = u;
    update();
  };
  unitWrap.appendChild(b);
});

// Button handlers
let aStage = 0;
let vStage = 0;

document.getElementById("hideA").addEventListener("click", () => {
  document.getElementById("areaCalc").classList.add("blurred");
  document.getElementById("hideA").style.display = "none";
  document.getElementById("showA").style.display = "inline-block";
  document.getElementById("stepA").style.display = "inline-block";
});

document.getElementById("showA").addEventListener("click", () => {
  document.getElementById("areaCalc").classList.remove("blurred");
  showAllArea();
  document.getElementById("hideA").style.display = "inline-block";
  document.getElementById("showA").style.display = "none";
  document.getElementById("stepA").style.display = "none";
  document.getElementById("nextA").style.display = "none";
  aStage = 0;
});

document.getElementById("stepA").addEventListener("click", () => {
  aStage = 0;
  hideAllArea();
  document.getElementById("areaCalc").classList.remove("blurred");
  document.getElementById("showA").style.display = "none";
  document.getElementById("stepA").style.display = "none";
  document.getElementById("hideA").style.display = "inline-block";
  document.getElementById("nextA").style.display = "inline-block";
});

document.getElementById("nextA").addEventListener("click", () => {
  aStage++;
  if (aStage > 5) {
    showAllArea();
    document.getElementById("nextA").style.display = "none";
  } else {
    showAreaStage(aStage);
  }
});

document.getElementById("hideV").addEventListener("click", () => {
  document.getElementById("volumeCalc").classList.add("blurred");
  document.getElementById("hideV").style.display = "none";
  document.getElementById("showV").style.display = "inline-block";
  document.getElementById("stepV").style.display = "inline-block";
});

document.getElementById("showV").addEventListener("click", () => {
  document.getElementById("volumeCalc").classList.remove("blurred");
  showAllVolume();
  document.getElementById("hideV").style.display = "inline-block";
  document.getElementById("showV").style.display = "none";
  document.getElementById("stepV").style.display = "none";
  document.getElementById("nextV").style.display = "none";
  vStage = 0;
});

document.getElementById("stepV").addEventListener("click", () => {
  vStage = 0;
  hideAllVolume();
  document.getElementById("volumeCalc").classList.remove("blurred");
  document.getElementById("showV").style.display = "none";
  document.getElementById("stepV").style.display = "none";
  document.getElementById("hideV").style.display = "inline-block";
  document.getElementById("nextV").style.display = "inline-block";
});

document.getElementById("nextV").addEventListener("click", () => {
  vStage++;
  if (vStage > 5) {
    showAllVolume();
    document.getElementById("nextV").style.display = "none";
  } else {
    showVolumeStage(vStage);
  }
});

function hideAllArea() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.add("blurred");
  }
}

function showAllArea() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function showAreaStage(stage) {
  // Unblur lines up to current stage
  for(let i=0; i<=stage; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function hideAllVolume() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.add("blurred");
  }
}

function showAllVolume() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function showVolumeStage(stage) {
  for(let i=0; i<=stage; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function fmt(n, places) {
  const nearInt = Math.abs(n - Math.round(n)) < 1e-9;
  if (nearInt) return String(Math.round(n));
  const fixed = Number(n).toFixed(places);
  return fixed.replace(/\.?0+$/, '');
}

function fmtInput(n) {
  if (Number.isInteger(n)) return String(n);
  return n % 1 === 0 ? String(n) : n.toFixed(2).replace(/\.?0+$/, '');
}

function getTruncatedWithRounding(n, places) {
  const truncStr = n.toFixed(places + 1);
  const nextDigit = parseInt(truncStr[truncStr.length - 1], 10);
  const roundUp = nextDigit >= 5;
  const parts = truncStr.split('.');
  const intPart = parts[0];
  const decPart = parts[1];
  const beforeLast = decPart.substring(0, decPart.length - 1);
  const lastDigit = decPart[decPart.length - 1];
  const arrow = roundUp ? '<span class="round-arrow round-up">↑</span>' : '<span class="round-arrow round-down">↓</span>';
  return `= ${intPart}.${beforeLast}${arrow}${lastDigit}…`;
}

function getRoundDir(n, places) {
  const truncStr = n.toFixed(places + 1);
  const nextDigit = parseInt(truncStr[truncStr.length - 1], 10);
  return nextDigit >= 5 ? "Round up" : "Round down";
}

function gcd(a, b) {
  a = Math.abs(Math.round(a));
  b = Math.abs(Math.round(b));
  while (b) { let t = b; b = a % b; a = t; }
  return a;
}

function mixedFrac(num, den) {
  if (den === 1) return String(num);
  const g = gcd(num, den);
  num = num / g;
  den = den / g;
  const whole = Math.floor(num / den);
  const remainder = num % den;
  if (remainder === 0) return String(whole);
  if (whole > 0) {
    return `${whole}<span class="frac"><span class="frac-num">${remainder}</span><span class="frac-den">${den}</span></span>`;
  }
  return `<span class="frac"><span class="frac-num">${num}</span><span class="frac-den">${den}</span></span>`;
}

function update() {
  const unitStr = unit && unit.symbol !== 'u' ? ' ' + unit.symbol : '';
  const unitStr2 = unit && unit.symbol !== 'u' ? ' ' + unit.symbol + '²' : '';
  const unitStr3 = unit && unit.symbol !== 'u' ? ' ' + unit.symbol + '³' : '';
  
  const unitDisplay = unit ? unit.symbol : 'u';
  const unitName = unit && unit.name ? unit.name : 'unit';
  const unitNamePlural = unitName + 's';

  const rDisp = fmtInput(r);
  
  document.getElementById("radiusDisplay").innerHTML = `<i>r</i> = ${rDisp} ${unitDisplay}`;
  
  document.getElementById("aMetaWords").textContent = `in ${unitNamePlural} squared to ${dp} decimal places`;
  document.getElementById("aMeta").textContent = `${unitDisplay}²    ${dp} dp`;
  
  document.getElementById("vMetaWords").textContent = `in ${unitNamePlural} cubed to ${dp} decimal places`;
  document.getElementById("vMeta").textContent = `${unitDisplay}³    ${dp} dp`;

  const saCoef = 4 * r * r;
  const volNumerator = 4 * r * r * r;
  const volDenominator = 3;
  const g = gcd(volNumerator, volDenominator);
  const simplifiedNum = volNumerator / g;
  const simplifiedDen = volDenominator / g;

  document.getElementById("aFormula").innerHTML = `<i>A</i> = 4 × π × <i>r</i>²`;
  document.getElementById("aS1").innerHTML = `= 4 × π × (${rDisp})²`;
  document.getElementById("aE").innerHTML = `<span class="label">A = </span>${fmt(saCoef, 2)}π${unitStr2} (exact)`;
  
  document.getElementById("vFormula").innerHTML = `<i>V</i> = <span class="frac"><span class="frac-num">4 × π × <i>r</i>³</span><span class="frac-den">3</span></span>`;
  document.getElementById("vS1").innerHTML = `= <span class="frac"><span class="frac-num">4 × π × (${rDisp})³</span><span class="frac-den">3</span></span>`;
  
  if (simplifiedDen === 1) {
    document.getElementById("vE").innerHTML = `<span class="label">V = </span>${simplifiedNum}π${unitStr3} (exact)`;
  } else {
    document.getElementById("vE").innerHTML = `<span class="label">V = </span><span class="frac"><span class="frac-num">${simplifiedNum}π</span><span class="frac-den">${simplifiedDen}</span></span>${unitStr3} (exact)`;
  }

  if (piMode === 'exact') {
    const sa = 4 * Math.PI * r * r;
    const vol = (4/3) * Math.PI * r * r * r;
    
    document.getElementById("aTrunc").innerHTML = getTruncatedWithRounding(sa, dp) + unitStr2;
    document.getElementById("aRound").textContent = getRoundDir(sa, dp);
    document.getElementById("aN").innerHTML = `<span class="label">A ≈ </span>${fmt(sa, dp)}${unitStr2} (${dp} dp)`;

    document.getElementById("vTrunc").innerHTML = getTruncatedWithRounding(vol, dp) + unitStr3;
    document.getElementById("vRound").textContent = getRoundDir(vol, dp);
    document.getElementById("vN").innerHTML = `<span class="label">V ≈ </span>${fmt(vol, dp)}${unitStr3} (${dp} dp)`;
    
  } else if (piMode === '22/7') {
    const saNum = 88 * r * r;
    const saDen = 7;
    
    const volNum = 88 * r * r * r;
    const volDen = 21;
    
    document.getElementById("aTrunc").innerHTML = `π ≈ <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span>: &nbsp; A = 4 × <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span> × (${rDisp})²`;
    document.getElementById("aRound").textContent = "";
    document.getElementById("aN").innerHTML = `<span class="label">A = </span><span class="frac"><span class="frac-num">${saNum}</span><span class="frac-den">${saDen}</span></span>${unitStr2} = ${mixedFrac(saNum, saDen)}${unitStr2}`;

    document.getElementById("vTrunc").innerHTML = `π ≈ <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span>: &nbsp; V = <span class="frac"><span class="frac-num">4</span><span class="frac-den">3</span></span> × <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span> × (${rDisp})³`;
    document.getElementById("vRound").textContent = "";
    document.getElementById("vN").innerHTML = `<span class="label">V = </span><span class="frac"><span class="frac-num">${volNum}</span><span class="frac-den">${volDen}</span></span>${unitStr3} = ${mixedFrac(volNum, volDen)}${unitStr3}`;
    
  } else if (piMode === '3.14') {
    const sa = 4 * 3.14 * r * r;
    const vol = (4/3) * 3.14 * r * r * r;
    
    document.getElementById("aTrunc").innerHTML = `π ≈ 3.14: &nbsp; A = 4 × 3.14 × (${rDisp})²`;
    document.getElementById("aRound").textContent = "";
    document.getElementById("aN").innerHTML = `<span class="label">A = </span>${fmt(sa, dp)}${unitStr2}`;

    document.getElementById("vTrunc").innerHTML = `π ≈ 3.14: &nbsp; V = <span class="frac"><span class="frac-num">4 × 3.14 × (${rDisp})³</span><span class="frac-den">3</span></span>`;
    document.getElementById("vRound").textContent = "";
    document.getElementById("vN").innerHTML = `<span class="label">V = </span>${fmt(vol, dp)}${unitStr3}`;
  }
}

unit = units[0];
update();
</script>
</body>
</html>
