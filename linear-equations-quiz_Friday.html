<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Equations Quiz</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4a4a4a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 30px 20px;
        }

        .container { max-width: 650px; margin: 0 auto; }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 6px;
            font-weight: 300;
            font-size: 2rem;
        }

        .level-title {
            color: rgba(255,255,255,0.9);
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .level-subtitle {
            color: rgba(255,255,255,0.65);
            text-align: center;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }

        .level-nav {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid transparent;
            color: white;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .level-btn:hover { background: rgba(255,255,255,0.25); }
        .level-btn.active { background: rgba(255,255,255,0.35); border-color: rgba(255,255,255,0.6); }
        .level-btn.completed { background: #009B77; }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            height: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #45B8AC, #009B77);
            height: 100%;
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 20px;
        }

        .quiz-card {
            background: white;
            border-radius: 16px;
            padding: 35px 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
            min-height: 380px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .question-num {
            background: #555;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .score-badge {
            background: linear-gradient(135deg, #009B77, #45B8AC);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .equation {
            font-size: 2.2rem;
            text-align: center;
            margin: 30px 0 35px;
            color: #333;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .choice-btn {
            background: #f5f5f5;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            font-size: 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
        }

        .choice-btn:hover:not(:disabled) {
            background: #e8e8e8;
            border-color: #ccc;
            transform: scale(1.02);
        }

        .choice-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
            animation: pulse 0.5s ease;
        }

        .choice-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .choice-btn:disabled { cursor: default; }

        .feedback {
            text-align: center;
            margin-top: 20px;
            min-height: 60px;
        }

        .feedback-correct {
            color: #28a745;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .feedback-incorrect {
            color: #721c24;
            background: #f8d7da;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            line-height: 1.5;
            text-align: left;
        }

        .feedback-incorrect strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .next-btn {
            display: block;
            margin: 20px auto 0;
            background: linear-gradient(135deg, #555, #333);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }

        /* Halfway & Results */
        .halfway, .results {
            text-align: center;
            padding: 20px 10px;
        }

        .halfway h2, .results h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #333;
        }

        .halfway .emoji, .results .emoji {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: bounce 0.6s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .halfway p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 2rem;
            font-weight: 700;
            color: #009B77;
            margin: 15px 0;
        }

        /* Certificate */
        .certificate {
            background: linear-gradient(135deg, #fffef0 0%, #fff8dc 100%);
            border: 8px double #c9a227;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
        }

        .certificate::before {
            content: 'üèÜ';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            background: white;
            padding: 0 10px;
        }

        .certificate h3 {
            font-size: 1.1rem;
            color: #666;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .certificate .cert-title {
            font-size: 1.6rem;
            color: #333;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .certificate .student-name {
            font-size: 2rem;
            color: #c9a227;
            font-family: 'Georgia', serif;
            font-style: italic;
            margin: 15px 0;
        }

        .certificate .achievement {
            font-size: 1rem;
            color: #555;
            margin-bottom: 10px;
        }

        .certificate .stars {
            font-size: 2rem;
            margin: 15px 0;
        }

        .name-input-section {
            margin: 20px 0;
        }

        .name-input {
            padding: 12px 20px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 25px;
            width: 200px;
            text-align: center;
            margin-right: 10px;
        }

        .name-input:focus {
            outline: none;
            border-color: #009B77;
        }

        .claim-btn {
            background: linear-gradient(135deg, #c9a227, #dfb93a);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .claim-btn:hover { transform: scale(1.05); }

        .countdown {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .restart-btn {
            background: linear-gradient(135deg, #6B5B95, #8B7BA5);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover { transform: scale(1.05); }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

        .hidden { display: none !important; }

        /* Trumpets animation */
        .trumpets {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 3rem;
            margin: 20px 0;
        }

        .trumpet-left {
            animation: trumpetLeft 0.5s ease infinite alternate;
        }

        .trumpet-right {
            animation: trumpetRight 0.5s ease infinite alternate;
        }

        @keyframes trumpetLeft {
            from { transform: rotate(-15deg); }
            to { transform: rotate(-25deg); }
        }

        @keyframes trumpetRight {
            from { transform: rotate(15deg); }
            to { transform: rotate(25deg); }
        }

        .victory-text {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #c9a227, #dfb93a, #c9a227);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 2s ease infinite;
        }

        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Linear Equations</h1>
        <div class="level-title" id="level-title">Level 1</div>
        <div class="level-subtitle" id="level-subtitle">x + a = b</div>
        
        <div class="level-nav" id="level-nav"></div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="quiz-card" id="quiz-card"></div>
    </div>

    <div class="confetti-container" id="confetti-container"></div>

    <script>
        // Audio context for victory sounds
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playNote(freq, duration, delay = 0, type = 'triangle') {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime + delay);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + delay + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + delay);
            osc.stop(audioCtx.currentTime + delay + duration);
        }

        function playCorrect() {
            initAudio();
            playNote(523, 0.15, 0);
            playNote(659, 0.15, 0.1);
            playNote(784, 0.2, 0.2);
        }

        function playIncorrect() {
            initAudio();
            playNote(200, 0.3, 0, 'sawtooth');
        }

        function playFanfare() {
            initAudio();
            const notes = [
                [523, 0.15], [523, 0.15], [523, 0.15], [659, 0.4],
                [587, 0.15], [587, 0.15], [587, 0.15], [784, 0.4],
                [698, 0.1], [784, 0.1], [880, 0.1], [784, 0.5]
            ];
            let time = 0;
            notes.forEach(([freq, dur]) => {
                playNote(freq, dur, time, 'triangle');
                time += dur + 0.05;
            });
        }

        function playVictory() {
            initAudio();
            const melody = [
                [392, 0.2], [392, 0.2], [392, 0.2], [311, 0.4],
                [349, 0.2], [392, 0.2], [311, 0.3], [349, 0.15], [392, 0.6],
                [523, 0.3], [523, 0.3], [523, 0.6]
            ];
            let time = 0;
            melody.forEach(([freq, dur]) => {
                playNote(freq, dur, time, 'triangle');
                playNote(freq * 1.5, dur, time, 'triangle');
                time += dur + 0.02;
            });
        }

        // Level definitions - each focused on ONE type
        const levels = [
            {
                id: 1,
                title: "Level 1",
                subtitle: "x + a = b",
                generate: () => {
                    const a = randInt(3, 15);
                    const x = randInt(2, 20);
                    const b = a + x;
                    return {
                        eq: `x + ${a} = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: a + b, error: `You added ${a} + ${b}. But to find x, you need to subtract: x = ${b} ‚àí ${a}` },
                            { val: a, error: `That's just the number being added to x. Subtract it from both sides: x = ${b} ‚àí ${a}` },
                            { val: b, error: `That's the total. Since x + ${a} = ${b}, x must be smaller than ${b}. Try x = ${b} ‚àí ${a}` }
                        ]
                    };
                }
            },
            {
                id: 2,
                title: "Level 2",
                subtitle: "x ‚àí a = b",
                generate: () => {
                    const a = randInt(3, 12);
                    const b = randInt(2, 15);
                    const x = a + b;
                    return {
                        eq: `x - ${a} = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: b - a, error: `You subtracted again! To undo "‚àí ${a}", you need to ADD ${a} to both sides: x = ${b} + ${a}` },
                            { val: Math.abs(b - a), error: `Wrong operation. When you see "x ‚àí ${a} = ${b}", add ${a} to ${b} to find x.` },
                            { val: a, error: `That's just one of the numbers. To isolate x, add ${a} to both sides: x = ${b} + ${a}` }
                        ]
                    };
                }
            },
            {
                id: 3,
                title: "Level 3",
                subtitle: "a + x = b",
                generate: () => {
                    const a = randInt(5, 18);
                    const x = randInt(2, 15);
                    const b = a + x;
                    return {
                        eq: `${a} + x = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: a + b, error: `You added ${a} + ${b}. Subtract instead: x = ${b} ‚àí ${a}` },
                            { val: a, error: `That's the number already added. Subtract it from ${b} to find x.` },
                            { val: b, error: `${b} is the result. x must be smaller: x = ${b} ‚àí ${a}` }
                        ]
                    };
                }
            },
            {
                id: 4,
                title: "Level 4",
                subtitle: "a ‚àí x = b",
                generate: () => {
                    const x = randInt(3, 10);
                    const a = randInt(x + 5, 25);
                    const b = a - x;
                    return {
                        eq: `${a} - x = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: a + b, error: `You added, but look carefully: ${a} ‚àí x = ${b}, so x = ${a} ‚àí ${b}` },
                            { val: b - a < 0 ? Math.abs(b - a) : b + 2, error: `Wrong order! It's ${a} ‚àí x = ${b}, so x = ${a} ‚àí ${b}` },
                            { val: a, error: `That's just one number from the equation. Calculate ${a} ‚àí ${b} to find x.` }
                        ]
                    };
                }
            },
            {
                id: 5,
                title: "Level 5",
                subtitle: "ax = b",
                generate: () => {
                    const a = randInt(2, 9);
                    const x = randInt(2, 12);
                    const b = a * x;
                    return {
                        eq: `${a}x = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: a * b, error: `You multiplied! But ${a}x means ${a} √ó x. To find x, divide: x = ${b} √∑ ${a}` },
                            { val: b - a, error: `This is multiplication, not addition. ${a}x = ${b} means x = ${b} √∑ ${a}` },
                            { val: a, error: `That's the coefficient (the number in front of x). Divide ${b} by ${a} to find x.` }
                        ]
                    };
                }
            },
            {
                id: 6,
                title: "Level 6",
                subtitle: "x √∑ a = b",
                generate: () => {
                    const a = randInt(2, 8);
                    const b = randInt(2, 10);
                    const x = a * b;
                    return {
                        eq: `\\dfrac{x}{${a}} = ${b}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: Math.round(b / a) || 1, error: `You divided again! To undo "√∑ ${a}", multiply both sides by ${a}: x = ${b} √ó ${a}` },
                            { val: b, error: `That's the result of dividing. Multiply ${b} by ${a} to get back to x.` },
                            { val: a + b, error: `This is division, not addition. To find x, multiply: x = ${b} √ó ${a}` }
                        ]
                    };
                }
            },
            {
                id: 7,
                title: "Level 7",
                subtitle: "ax + b = c",
                generate: () => {
                    const a = randInt(2, 6);
                    const b = randInt(3, 12);
                    const x = randInt(2, 10);
                    const c = a * x + b;
                    return {
                        eq: `${a}x + ${b} = ${c}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: c - b, error: `You subtracted ${b} but forgot to divide by ${a}! Full solution: x = (${c} ‚àí ${b}) √∑ ${a}` },
                            { val: Math.round(c / a), error: `You divided by ${a} first, but you need to subtract ${b} before dividing.` },
                            { val: Math.round((c + b) / a), error: `You added ${b} instead of subtracting it. Subtract ${b} from ${c}, then divide by ${a}.` }
                        ]
                    };
                }
            },
            {
                id: 8,
                title: "Level 8",
                subtitle: "ax ‚àí b = c",
                generate: () => {
                    const a = randInt(2, 6);
                    const b = randInt(3, 12);
                    const x = randInt(3, 10);
                    const c = a * x - b;
                    return {
                        eq: `${a}x - ${b} = ${c}`,
                        ans: x,
                        choices: [
                            { val: x, correct: true },
                            { val: c + b, error: `You added ${b} but forgot to divide by ${a}! Full solution: x = (${c} + ${b}) √∑ ${a}` },
                            { val: Math.abs(c - b), error: `You subtracted instead of adding! To undo "‚àí ${b}", add ${b} to ${c}, then divide by ${a}.` },
                            { val: Math.round(c / a), error: `You divided but forgot to add ${b} first. Add ${b} to ${c}, then divide by ${a}.` }
                        ]
                    };
                }
            }
        ];

        function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // State
        let currentLevel = 0;
        let currentQ = 0;
        let score = 0;
        let questions = [];
        let answered = false;
        let countdownInterval = null;

        function buildLevelNav() {
            const nav = document.getElementById('level-nav');
            nav.innerHTML = '';
            levels.forEach((lvl, i) => {
                const btn = document.createElement('button');
                btn.className = 'level-btn' + (i === currentLevel ? ' active' : '');
                btn.textContent = lvl.id;
                btn.onclick = () => setLevel(i);
                nav.appendChild(btn);
            });
        }

        function setLevel(index) {
            currentLevel = index;
            currentQ = 0;
            score = 0;
            questions = [];
            for (let i = 0; i < 6; i++) {
                const q = levels[currentLevel].generate();
                q.choices = shuffle(q.choices);
                questions.push(q);
            }
            document.getElementById('level-title').textContent = levels[currentLevel].title;
            document.getElementById('level-subtitle').textContent = levels[currentLevel].subtitle;
            buildLevelNav();
            renderQuestion();
        }

        function updateProgress() {
            document.getElementById('progress-fill').style.width = `${(currentQ / 6) * 100}%`;
        }

        function renderQuestion() {
            answered = false;
            updateProgress();
            const card = document.getElementById('quiz-card');
            const q = questions[currentQ];

            card.innerHTML = `
                <div class="question-header">
                    <span class="question-num">Question ${currentQ + 1} of 6</span>
                    <span class="score-badge">Score: ${score}/6</span>
                </div>
                <div class="equation" id="equation"></div>
                <div class="choices" id="choices"></div>
                <div class="feedback" id="feedback"></div>
            `;

            katex.render(q.eq + ', \\quad x = \\, ?', document.getElementById('equation'), { displayMode: true });

            const choicesDiv = document.getElementById('choices');
            q.choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.val;
                btn.onclick = () => checkAnswer(choice, btn, q.ans);
                choicesDiv.appendChild(btn);
            });
        }

        function checkAnswer(choice, btn, correctAns) {
            if (answered) return;
            answered = true;

            const feedback = document.getElementById('feedback');
            const allBtns = document.querySelectorAll('.choice-btn');

            allBtns.forEach(b => {
                b.disabled = true;
                if (parseInt(b.textContent) === correctAns) b.classList.add('correct');
            });

            if (choice.correct) {
                score++;
                playCorrect();
                btn.classList.add('correct');
                feedback.innerHTML = '<div class="feedback-correct">‚úì Correct! Excellent!</div>';
            } else {
                playIncorrect();
                btn.classList.add('incorrect');
                feedback.innerHTML = `<div class="feedback-incorrect"><strong>‚úó Not quite!</strong>${choice.error}</div>`;
            }

            const nextBtn = document.createElement('button');
            nextBtn.className = 'next-btn';
            nextBtn.textContent = currentQ < 5 ? 'Next Question ‚Üí' : 'See Results ‚Üí';
            nextBtn.onclick = nextQuestion;
            document.getElementById('quiz-card').appendChild(nextBtn);
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ === 3) {
                showHalfway();
            } else if (currentQ >= 6) {
                showResults();
            } else {
                renderQuestion();
            }
        }

        function showHalfway() {
            updateProgress();
            playFanfare();
            launchConfetti();
            const card = document.getElementById('quiz-card');
            card.innerHTML = `
                <div class="halfway">
                    <div class="emoji">üéØ</div>
                    <h2>Halfway There!</h2>
                    <p>Brilliant work so far‚Äîkeep it going!</p>
                    <div class="score-display">${score} out of 3</div>
                    <button class="next-btn" onclick="renderQuestion()">Continue ‚Üí</button>
                </div>
            `;
        }

        function showResults() {
            updateProgress();
            playVictory();
            launchConfetti();

            const stars = score >= 6 ? '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê' : score >= 5 ? '‚≠ê‚≠ê‚≠ê‚≠ê' : score >= 4 ? '‚≠ê‚≠ê‚≠ê' : score >= 2 ? '‚≠ê‚≠ê' : '‚≠ê';
            let message = '';
            if (score === 6) message = "PERFECT SCORE! Outstanding work!";
            else if (score >= 5) message = "Excellent! Nearly perfect!";
            else if (score >= 4) message = "Great job! Keep practising!";
            else if (score >= 3) message = "Good effort! You're improving!";
            else message = "Keep going‚Äîpractice makes perfect!";

            const card = document.getElementById('quiz-card');
            card.innerHTML = `
                <div class="results">
                    <div class="trumpets">
                        <span class="trumpet-left">üé∫</span>
                        <span class="trumpet-right">üé∫</span>
                    </div>
                    <div class="victory-text">VICTORY!</div>
                    <div class="score-display" style="font-size: 3rem; margin: 20px 0;">${score}/6</div>
                    <p style="font-size: 1.2rem; color: #666; margin-bottom: 20px;">${message}</p>
                    
                    <div class="name-input-section" id="name-section">
                        <p style="margin-bottom: 15px; color: #555;">üèÜ Claim your certificate!</p>
                        <input type="text" class="name-input" id="name-input" placeholder="Your first name" maxlength="20">
                        <button class="claim-btn" onclick="claimCertificate()">Claim</button>
                        <div class="countdown" id="countdown">Certificate expires in <span id="timer">30</span> seconds...</div>
                    </div>

                    <div id="certificate-area"></div>

                    <div style="margin-top: 20px;">
                        <button class="restart-btn" onclick="setLevel(${currentLevel})">üîÑ Try Again</button>
                        ${currentLevel < levels.length - 1 ? `<button class="restart-btn" onclick="setLevel(${currentLevel + 1})">Next Level ‚Üí</button>` : ''}
                    </div>
                </div>
            `;

            let timeLeft = 30;
            countdownInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('timer');
                if (timerEl) timerEl.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    const nameSection = document.getElementById('name-section');
                    if (nameSection) nameSection.innerHTML = '<p style="color: #999;">Certificate offer expired</p>';
                }
            }, 1000);
        }

        function claimCertificate() {
            const nameInput = document.getElementById('name-input');
            const studentName = nameInput.value.trim() || 'Champion';
            clearInterval(countdownInterval);

            const stars = score >= 6 ? '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê' : score >= 5 ? '‚≠ê‚≠ê‚≠ê‚≠ê' : score >= 4 ? '‚≠ê‚≠ê‚≠ê' : score >= 2 ? '‚≠ê‚≠ê' : '‚≠ê';

            document.getElementById('name-section').classList.add('hidden');
            document.getElementById('certificate-area').innerHTML = `
                <div class="certificate" id="certificate">
                    <h3>Certificate of Achievement</h3>
                    <div class="cert-title">Linear Equations</div>
                    <div class="student-name">${studentName}</div>
                    <div class="achievement">Completed ${levels[currentLevel].title}<br><em>${levels[currentLevel].subtitle}</em></div>
                    <div class="achievement">Score: <strong>${score}/6</strong></div>
                    <div class="stars">${stars}</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 10px;">${new Date().toLocaleDateString()}</div>
                </div>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">üì∏ Screenshot now before it vanishes!</p>
            `;

            playFanfare();
            launchConfetti();
        }

        function launchConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = '';
            const colors = ['#6B5B95', '#009B77', '#DD4132', '#D65076', '#45B8AC', '#FFD700', '#c9a227'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.style.animationDelay = Math.random() * 0.8 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                container.appendChild(confetti);
            }
            setTimeout(() => container.innerHTML = '', 5000);
        }

        buildLevelNav();
        setLevel(0);
    </script>
</body>
</html>
