<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cylinder Calculator</title>

<style>
:root{--ink:#000;--line:#cfcfcf;--muted:#666;--blue:#2563eb}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#fff;color:var(--ink)}
.wrap{max-width:900px;margin:6px auto;padding:0 6px}
.card{border:1px solid var(--line);border-radius:10px;padding:12px}

.controls-row{display:flex;flex-wrap:wrap;gap:8px;align-items:start;margin-bottom:12px}
.block{border:1px solid var(--line);border-radius:8px;padding:8px}
.block h3{margin:0 0 4px;font-size:12px}

.shape-block{min-width:140px}
.shape-title{font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:700}
.shape-sub{font-size:11px;color:var(--muted);margin-top:2px}

.input-block{display:flex;align-items:center;gap:10px;padding:8px 14px}
.input-block h3{margin:0;font-size:13px;min-width:60px}
.input-container{display:flex;align-items:center;gap:4px}
.value-input{width:80px;border:2px solid var(--blue);border-radius:6px;padding:6px 8px;font-size:20px;text-align:center;font-family:"Times New Roman",Times,serif;font-weight:bold}
.value-input:focus{outline:none;border-color:#000}
.arrow-buttons{display:flex;flex-direction:column;gap:2px}
.arrow-btn{width:30px;height:24px;border:2px solid var(--line);border-radius:4px;background:#fff;cursor:pointer;font-size:16px;font-weight:bold;display:flex;align-items:center;justify-content:center;user-select:none}
.arrow-btn:hover{background:#f0f0f0}
.arrow-btn:active{background:#e0e0e0}
.input-display{font-family:"Times New Roman",Times,serif;font-size:18px}

.unit-block{display:flex;align-items:center;gap:8px}
.unit-select{padding:5px 8px;border:1px solid var(--line);border-radius:5px;font-size:13px;background:#fff;cursor:pointer}

.dprow{display:flex;gap:4px}
.dprow button{flex:1;border:1px solid var(--line);border-radius:6px;background:#fff;font-size:12px;padding:6px 10px;cursor:pointer}
.dprow button.active{background:#000;color:#fff}

.btnrow{display:grid;grid-template-columns:repeat(5,1fr);gap:3px}
.btnrow button{border:1px solid var(--line);border-radius:5px;background:#fff;font-size:11px;padding:5px 3px;cursor:pointer}
.btnrow button.active{background:#000;color:#fff}

.reveal-btn-small{border:2px solid var(--line);border-radius:6px;background:#fff;font-size:16px;padding:8px 20px;cursor:pointer;margin-top:6px;font-weight:600;margin-right:6px}
.reveal-btn-small:hover{background:#f5f5f5}

.button-row{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}

.main{display:block}

.diagram svg{width:100%;height:auto;display:block}

.calc-section{display:flex;flex-direction:column}
.formula-header{text-align:center;margin-bottom:8px}
.formula-large{font-family:"Times New Roman",Times,serif;font-size:32px;font-weight:bold}
.formula-label{font-size:18px;color:var(--muted);margin-top:2px;font-weight:600}
.formula-meta{font-size:16px;color:var(--muted);margin-top:4px;font-family:Segoe UI,Arial,sans-serif}

.calc{border:1px solid var(--line);border-radius:8px;padding:12px}
.work-line{display:flex;justify-content:space-between;align-items:center;margin:8px 0;min-height:30px}
.math-content{font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:bold;flex:1}
.logic-hint{font-family:Segoe UI,Arial,sans-serif;font-size:18px;color:var(--blue);font-style:italic;font-weight:600;margin-left:20px;white-space:nowrap}

.answer-container{margin:10px 0}
.answer-box{display:inline-block;border:2px solid #000;padding:8px 14px;font-family:"Times New Roman",Times,serif;font-size:22px;font-weight:bold}
.answer-box .label{font-style:italic}

.round-arrow{font-size:20px;font-weight:bold}
.round-up{color:#16a34a}
.round-down{color:#dc2626}

.frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;margin:0 2px}
.frac-num{border-bottom:2px solid #000;padding:0 3px 1px;font-size:0.85em}
.frac-den{padding:1px 3px 0;font-size:0.85em}

.blurred{filter:blur(5px)}

.checkbox-row{display:flex;align-items:center;gap:6px;margin-top:8px}
.checkbox-row input{cursor:pointer}
.checkbox-row label{cursor:pointer;font-size:12px}

@media(max-width:700px){
  .main{grid-template-columns:1fr}
  .formula-large{font-size:28px}
}
</style>
</head>

<body>
<div class="wrap">
<section class="card">

<div class="controls-row">
  <div class="block">
    <h3>Value of π</h3>
    <div class="dprow" id="piBtns"></div>
  </div>
  
  <div class="block">
    <h3>Decimal places</h3>
    <div class="dprow" id="dpBtns"></div>
  </div>
  
  <div class="block">
    <h3>Units</h3>
    <div class="btnrow" id="unitBtns"></div>
    <div class="checkbox-row">
      <input type="checkbox" id="differentUnits">
      <label for="differentUnits">Use different units</label>
    </div>
  </div>
</div>

<div class="main">
  <div style="display:flex;gap:40px;margin-bottom:20px;">
    <div class="diagram-area">
      <div class="diagram">
        <svg viewBox="0 0 200 260" aria-label="Cylinder diagram">
          <defs>
            <linearGradient id="cylGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#e5e7eb"/>
              <stop offset="50%" style="stop-color:#f9fafb"/>
              <stop offset="100%" style="stop-color:#e5e7eb"/>
            </linearGradient>
            <radialGradient id="topGrad">
              <stop offset="0%" style="stop-color:#f9fafb"/>
              <stop offset="100%" style="stop-color:#d1d5db"/>
            </radialGradient>
            <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="5" markerHeight="5" orient="auto">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="#000"/>
            </marker>
          </defs>
          
          <!-- Cylinder body -->
          <rect x="40" y="80" width="120" height="120" fill="url(#cylGrad)" stroke="none"/>
          <path d="M 40 80 A 60 15 0 0 0 40 200" stroke="#000" stroke-width="2" fill="none"/>
          <path d="M 160 80 A 60 15 0 0 1 160 200" stroke="#000" stroke-width="2" fill="none"/>
          
          <!-- Top ellipse -->
          <ellipse cx="100" cy="80" rx="60" ry="15" fill="url(#topGrad)" stroke="#000" stroke-width="2"/>
          
          <!-- Bottom ellipse -->
          <path d="M 40 200 A 60 15 0 0 0 160 200" fill="none" stroke="#000" stroke-width="1.5" stroke-dasharray="4,3"/>
          <path d="M 160 200 A 60 15 0 0 0 40 200" fill="none" stroke="#000" stroke-width="2"/>
          
          <!-- Radius line -->
          <line x1="100" y1="80" x2="158" y2="80" stroke="#000" stroke-width="2" marker-end="url(#arrow)"/>
          <text x="125" y="72" font-size="16" font-family="Times New Roman" font-style="italic">r</text>
          
          <!-- Height line -->
          <line x1="175" y1="80" x2="175" y2="200" stroke="#000" stroke-width="2"/>
          <line x1="172" y1="80" x2="178" y2="80" stroke="#000" stroke-width="2"/>
          <line x1="172" y1="200" x2="178" y2="200" stroke="#000" stroke-width="2"/>
          <text x="182" y="145" font-size="16" font-family="Times New Roman" font-style="italic">h</text>
        </svg>
      </div>
    </div>
    
    <div style="margin-top:20px;">
      <div class="block shape-block" style="margin-bottom:12px;">
        <div class="shape-title">Cylinder</div>
        <div class="shape-sub">3D solid</div>
      </div>
      
      <div class="block input-block">
        <h3>Radius</h3>
        <div class="input-container">
          <input type="number" class="value-input" id="radiusInput" min="0" step="1" value="2">
          <div class="arrow-buttons">
            <button class="arrow-btn" id="radiusUp">▲</button>
            <button class="arrow-btn" id="radiusDown">▼</button>
          </div>
        </div>
        <div class="input-display" id="radiusDisplay"></div>
        <div class="unit-block" id="radiusUnitBlock" style="display:none;">
          <select class="unit-select" id="radiusUnit"></select>
        </div>
      </div>
      
      <div class="block input-block">
        <h3>Height</h3>
        <div class="input-container">
          <input type="number" class="value-input" id="heightInput" min="0" step="1" value="8">
          <div class="arrow-buttons">
            <button class="arrow-btn" id="heightUp">▲</button>
            <button class="arrow-btn" id="heightDown">▼</button>
          </div>
        </div>
        <div class="input-display" id="heightDisplay"></div>
        <div class="unit-block" id="heightUnitBlock" style="display:none;">
          <select class="unit-select" id="heightUnit"></select>
        </div>
      </div>
    </div>
  </div>
  
  <div style="margin-bottom:20px;padding:10px;border:1px solid var(--line);border-radius:8px;background:#f9fafb;">
    <div style="font-size:18px;font-weight:600;margin-bottom:8px;">Surface area and volume</div>
    <div style="font-size:14px;line-height:1.6;">
      In the following, <i style="font-family:'Times New Roman',Times,serif;">A</i> represents the <strong>curved</strong> surface area and <i style="font-family:'Times New Roman',Times,serif;">V</i> represents the volume of the solid in question.
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;">
    <div class="calc-section">
    <div class="formula-header">
      <div class="formula-label">Curved Surface Area (CSA)</div>
      <div class="formula-meta" id="aMetaWords"></div>
      <div class="formula-large"><i>A</i> = 2π<i>rh</i></div>
      <div class="formula-meta" id="aMeta"></div>
      <div class="button-row">
        <button class="reveal-btn-small" id="hideA">Hide</button>
        <button class="reveal-btn-small" id="showA" style="display:none;">Show</button>
        <button class="reveal-btn-small" id="stepA" style="display:none;">Step by Step</button>
        <button class="reveal-btn-small" id="nextA" style="display:none;">Next</button>
      </div>
    </div>
    <div class="calc" id="areaCalc">
      <div class="work-line" id="aLine0">
        <div class="math-content" id="aFormula"></div>
        <div class="logic-hint">Formula</div>
      </div>
      <div class="work-line" id="aLine1">
        <div class="math-content" id="aS1"></div>
        <div class="logic-hint">Substitution</div>
      </div>
      <div class="work-line" id="aLine2">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="aE"></div>
        </div>
        <div class="logic-hint">Simplify</div>
      </div>
      <div class="work-line" id="aLine3">
        <div class="math-content" id="aTrunc"></div>
        <div class="logic-hint" id="aTruncHint">Truncate (dp+1)</div>
      </div>
      <div class="work-line" id="aLine4">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="aN"></div>
        </div>
        <div class="logic-hint" id="aRound"></div>
      </div>
    </div>
  </div>

    <div class="calc-section">
    <div class="formula-header">
      <div class="formula-label">Volume (Vol)</div>
      <div class="formula-meta" id="vMetaWords"></div>
      <div class="formula-large"><i>V</i> = π<i>r</i>²<i>h</i></div>
      <div class="formula-meta" id="vMeta"></div>
      <div class="button-row">
        <button class="reveal-btn-small" id="hideV">Hide</button>
        <button class="reveal-btn-small" id="showV" style="display:none;">Show</button>
        <button class="reveal-btn-small" id="stepV" style="display:none;">Step by Step</button>
        <button class="reveal-btn-small" id="nextV" style="display:none;">Next</button>
      </div>
    </div>
    <div class="calc" id="volumeCalc">
      <div class="work-line" id="vLine0">
        <div class="math-content" id="vFormula"></div>
        <div class="logic-hint">Formula</div>
      </div>
      <div class="work-line" id="vLine1">
        <div class="math-content" id="vS1"></div>
        <div class="logic-hint">Substitution</div>
      </div>
      <div class="work-line" id="vLine2">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="vE"></div>
        </div>
        <div class="logic-hint">Simplify</div>
      </div>
      <div class="work-line" id="vLine3">
        <div class="math-content" id="vTrunc"></div>
        <div class="logic-hint" id="vTruncHint">Truncate (dp+1)</div>
      </div>
      <div class="work-line" id="vLine4">
        <div class="answer-container" style="margin:0;">
          <div class="answer-box" id="vN"></div>
        </div>
        <div class="logic-hint" id="vRound"></div>
      </div>
    </div>
  </div>
  </div>
</div>

</section>
</div>

<script>
const units = [
  {symbol:'u',name:'unit'},
  {symbol:'mm',name:'millimetre'},
  {symbol:'cm',name:'centimetre'},
  {symbol:'m',name:'metre'},
  {symbol:'km',name:'kilometre'},
  {symbol:'in',name:'inch'},
  {symbol:'ft',name:'foot'},
  {symbol:'yd',name:'yard'},
  {symbol:'mi',name:'mile'}
];

let r = 2, h = 8;
let unit = units[0];
let rUnit = units[0], hUnit = units[0];
let piMode = 'exact';
let dp = 2;
let useDifferentUnits = false;

const piOpts = ['exact','22/7','3.14'];
const dpOpts = [1,2,3];

const piCont = document.getElementById("piBtns");
piOpts.forEach(opt => {
  const b = document.createElement("button");
  b.textContent = opt === 'exact' ? 'π' : opt;
  if (opt === piMode) b.classList.add("active");
  b.addEventListener("click", () => {
    piMode = opt;
    document.querySelectorAll("#piBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    update();
  });
  piCont.appendChild(b);
});

const dpCont = document.getElementById("dpBtns");
dpOpts.forEach(val => {
  const b = document.createElement("button");
  b.textContent = String(val);
  if (val === dp) b.classList.add("active");
  b.addEventListener("click", () => {
    dp = val;
    document.querySelectorAll("#dpBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    update();
  });
  dpCont.appendChild(b);
});

const uCont = document.getElementById("unitBtns");
units.forEach(u => {
  const b = document.createElement("button");
  b.textContent = u.symbol;
  if (u.symbol === unit.symbol) b.classList.add("active");
  b.addEventListener("click", () => {
    unit = u;
    rUnit = u;
    hUnit = u;
    document.querySelectorAll("#unitBtns button").forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    populateUnitSelects();
    update();
  });
  uCont.appendChild(b);
});

function populateUnitSelects() {
  const rSel = document.getElementById("radiusUnit");
  const hSel = document.getElementById("heightUnit");
  rSel.innerHTML = '';
  hSel.innerHTML = '';
  units.forEach(u => {
    const opt1 = document.createElement("option");
    opt1.value = u.symbol;
    opt1.textContent = u.symbol;
    if (u.symbol === rUnit.symbol) opt1.selected = true;
    rSel.appendChild(opt1);
    
    const opt2 = document.createElement("option");
    opt2.value = u.symbol;
    opt2.textContent = u.symbol;
    if (u.symbol === hUnit.symbol) opt2.selected = true;
    hSel.appendChild(opt2);
  });
}
populateUnitSelects();

document.getElementById("differentUnits").addEventListener("change", (e) => {
  useDifferentUnits = e.target.checked;
  document.getElementById("radiusUnitBlock").style.display = useDifferentUnits ? 'flex' : 'none';
  document.getElementById("heightUnitBlock").style.display = useDifferentUnits ? 'flex' : 'none';
  update();
});

document.getElementById("radiusUnit").addEventListener("change", (e) => {
  rUnit = units.find(u => u.symbol === e.target.value);
  update();
});

document.getElementById("heightUnit").addEventListener("change", (e) => {
  hUnit = units.find(u => u.symbol === e.target.value);
  update();
});

document.getElementById("radiusInput").addEventListener("input", (e) => {
  r = parseFloat(e.target.value) || 0;
  update();
});

document.getElementById("heightInput").addEventListener("input", (e) => {
  h = parseFloat(e.target.value) || 0;
  update();
});

document.getElementById("radiusUp").addEventListener("click", () => {
  r = Math.max(0, r + 1);
  document.getElementById("radiusInput").value = r;
  update();
});

document.getElementById("radiusDown").addEventListener("click", () => {
  r = Math.max(0, r - 1);
  document.getElementById("radiusInput").value = r;
  update();
});

document.getElementById("heightUp").addEventListener("click", () => {
  h = Math.max(0, h + 1);
  document.getElementById("heightInput").value = h;
  update();
});

document.getElementById("heightDown").addEventListener("click", () => {
  h = Math.max(0, h - 1);
  document.getElementById("heightInput").value = h;
  update();
});

let aStage = 0;
let vStage = 0;

document.getElementById("hideA").addEventListener("click", () => {
  hideAllArea();
  document.getElementById("hideA").style.display = "none";
  document.getElementById("showA").style.display = "inline-block";
  document.getElementById("stepA").style.display = "inline-block";
});

document.getElementById("showA").addEventListener("click", () => {
  showAllArea();
  aStage = 0;
  document.getElementById("hideA").style.display = "inline-block";
  document.getElementById("showA").style.display = "none";
  document.getElementById("stepA").style.display = "none";
  document.getElementById("nextA").style.display = "none";
});

document.getElementById("stepA").addEventListener("click", () => {
  aStage = 0;
  hideAllArea();
  showAreaStage(aStage);
  document.getElementById("showA").style.display = "none";
  document.getElementById("stepA").style.display = "none";
  document.getElementById("nextA").style.display = "inline-block";
});

document.getElementById("nextA").addEventListener("click", () => {
  aStage++;
  if (aStage > 4) {
    showAllArea();
    document.getElementById("nextA").style.display = "none";
    document.getElementById("hideA").style.display = "inline-block";
  } else {
    showAreaStage(aStage);
  }
});

document.getElementById("hideV").addEventListener("click", () => {
  hideAllVolume();
  document.getElementById("hideV").style.display = "none";
  document.getElementById("showV").style.display = "inline-block";
  document.getElementById("stepV").style.display = "inline-block";
});

document.getElementById("showV").addEventListener("click", () => {
  showAllVolume();
  vStage = 0;
  document.getElementById("hideV").style.display = "inline-block";
  document.getElementById("showV").style.display = "none";
  document.getElementById("stepV").style.display = "none";
  document.getElementById("nextV").style.display = "none";
});

document.getElementById("stepV").addEventListener("click", () => {
  vStage = 0;
  hideAllVolume();
  showVolumeStage(vStage);
  document.getElementById("showV").style.display = "none";
  document.getElementById("stepV").style.display = "none";
  document.getElementById("nextV").style.display = "inline-block";
});

document.getElementById("nextV").addEventListener("click", () => {
  vStage++;
  if (vStage > 4) {
    showAllVolume();
    document.getElementById("nextV").style.display = "none";
    document.getElementById("hideV").style.display = "inline-block";
  } else {
    showVolumeStage(vStage);
  }
});

function hideAllArea() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.add("blurred");
  }
}

function showAllArea() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function showAreaStage(stage) {
  for(let i=0; i<=stage; i++) {
    const el = document.getElementById("aLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function hideAllVolume() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.add("blurred");
  }
}

function showAllVolume() {
  for(let i=0; i<=4; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function showVolumeStage(stage) {
  for(let i=0; i<=stage; i++) {
    const el = document.getElementById("vLine"+i);
    if(el) el.classList.remove("blurred");
  }
}

function fmt(n, places) {
  const nearInt = Math.abs(n - Math.round(n)) < 1e-9;
  if (nearInt) return String(Math.round(n));
  const fixed = Number(n).toFixed(places);
  return fixed.replace(/\.?0+$/, '');
}

function fmtInput(n) {
  if (Number.isInteger(n)) return String(n);
  return n % 1 === 0 ? String(n) : n.toFixed(2).replace(/\.?0+$/, '');
}

function getTruncatedWithRounding(n, places) {
  const truncStr = n.toFixed(places + 1);
  const nextDigit = parseInt(truncStr[truncStr.length - 1], 10);
  const roundUp = nextDigit >= 5;
  const parts = truncStr.split('.');
  const intPart = parts[0];
  const decPart = parts[1];
  const beforeLast = decPart.substring(0, decPart.length - 1);
  const lastDigit = decPart[decPart.length - 1];
  const arrow = roundUp ? '<span class="round-arrow round-up">↑</span>' : '<span class="round-arrow round-down">↓</span>';
  return `= ${intPart}.${beforeLast}${arrow}${lastDigit}…`;
}

function getRoundDir(n, places) {
  const truncStr = n.toFixed(places + 1);
  const nextDigit = parseInt(truncStr[truncStr.length - 1], 10);
  return nextDigit >= 5 ? "Round up" : "Round down";
}

function gcd(a, b) {
  a = Math.abs(Math.round(a));
  b = Math.abs(Math.round(b));
  while (b) { let t = b; b = a % b; a = t; }
  return a;
}

function mixedFrac(num, den) {
  if (den === 1) return String(num);
  const g = gcd(num, den);
  num = num / g;
  den = den / g;
  const whole = Math.floor(num / den);
  const remainder = num % den;
  if (remainder === 0) return String(whole);
  if (whole > 0) {
    return `${whole}<span class="frac"><span class="frac-num">${remainder}</span><span class="frac-den">${den}</span></span>`;
  }
  return `<span class="frac"><span class="frac-num">${num}</span><span class="frac-den">${den}</span></span>`;
}

function update() {
  const rDisp = fmtInput(r);
  const hDisp = fmtInput(h);
  
  const rUnitSymbol = useDifferentUnits ? rUnit.symbol : (unit ? unit.symbol : 'u');
  const hUnitSymbol = useDifferentUnits ? hUnit.symbol : (unit ? unit.symbol : 'u');
  
  const rUnitName = useDifferentUnits ? (rUnit.name || 'unit') : (unit && unit.name ? unit.name : 'unit');
  const hUnitName = useDifferentUnits ? (hUnit.name || 'unit') : (unit && unit.name ? unit.name : 'unit');
  
  const unitStr2 = useDifferentUnits ? ` ${rUnitSymbol} × ${hUnitSymbol}` : (unit && unit.symbol !== 'u' ? ' ' + unit.symbol + '²' : '');
  const unitStr3 = useDifferentUnits ? ` ${rUnitSymbol}² × ${hUnitSymbol}` : (unit && unit.symbol !== 'u' ? ' ' + unit.symbol + '³' : '');
  
  document.getElementById("radiusDisplay").innerHTML = `<i>r</i> = ${rDisp} ${rUnitSymbol}`;
  document.getElementById("heightDisplay").innerHTML = `<i>h</i> = ${hDisp} ${hUnitSymbol}`;
  
  const areaUnitName = useDifferentUnits ? `${rUnitName}s × ${hUnitName}s` : `${rUnitName}s squared`;
  const volUnitName = useDifferentUnits ? `${rUnitName}s squared × ${hUnitName}s` : `${rUnitName}s cubed`;
  
  document.getElementById("aMetaWords").textContent = `in ${areaUnitName} to ${dp} decimal places`;
  document.getElementById("aMeta").textContent = useDifferentUnits ? `${rUnitSymbol} × ${hUnitSymbol}    ${dp} dp` : `${unit.symbol}²    ${dp} dp`;
  
  document.getElementById("vMetaWords").textContent = `in ${volUnitName} to ${dp} decimal places`;
  document.getElementById("vMeta").textContent = useDifferentUnits ? `${rUnitSymbol}² × ${hUnitSymbol}    ${dp} dp` : `${unit.symbol}³    ${dp} dp`;

  const csaCoef = 2 * r * h;
  const volCoef = r * r * h;

  document.getElementById("aFormula").innerHTML = `<i>A</i> = 2 × π × <i>r</i> × <i>h</i>`;
  document.getElementById("aS1").innerHTML = `= 2 × π × ${rDisp} × ${hDisp}`;
  document.getElementById("aE").innerHTML = `<span class="label">A = </span>${fmt(csaCoef, 2)}π${unitStr2} (exact)`;
  
  document.getElementById("vFormula").innerHTML = `<i>V</i> = π × <i>r</i>² × <i>h</i>`;
  document.getElementById("vS1").innerHTML = `= π × ${rDisp}² × ${hDisp}`;
  document.getElementById("vE").innerHTML = `<span class="label">V = </span>${fmt(volCoef, 2)}π${unitStr3} (exact)`;

  if (piMode === 'exact') {
    const csa = 2 * Math.PI * r * h;
    const vol = Math.PI * r * r * h;
    
    document.getElementById("aTrunc").innerHTML = getTruncatedWithRounding(csa, dp) + unitStr2;
    document.getElementById("aRound").textContent = getRoundDir(csa, dp);
    document.getElementById("aN").innerHTML = `<span class="label">A ≈ </span>${fmt(csa, dp)}${unitStr2} (${dp} dp)`;

    document.getElementById("vTrunc").innerHTML = getTruncatedWithRounding(vol, dp) + unitStr3;
    document.getElementById("vRound").textContent = getRoundDir(vol, dp);
    document.getElementById("vN").innerHTML = `<span class="label">V ≈ </span>${fmt(vol, dp)}${unitStr3} (${dp} dp)`;
    
  } else if (piMode === '22/7') {
    const csaNum = 44 * r * h;
    const csaDen = 7;
    
    const volNum = 22 * r * r * h;
    const volDen = 7;
    
    document.getElementById("aTrunc").innerHTML = `π ≈ <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span>: &nbsp; A = <span class="frac"><span class="frac-num">2 × 22 × ${rDisp} × ${hDisp}</span><span class="frac-den">7</span></span>`;
    document.getElementById("aRound").textContent = "";
    document.getElementById("aN").innerHTML = `<span class="label">A = </span><span class="frac"><span class="frac-num">${csaNum}</span><span class="frac-den">${csaDen}</span></span>${unitStr2} = ${mixedFrac(csaNum, csaDen)}${unitStr2}`;

    document.getElementById("vTrunc").innerHTML = `π ≈ <span class="frac"><span class="frac-num">22</span><span class="frac-den">7</span></span>: &nbsp; V = <span class="frac"><span class="frac-num">22 × ${rDisp}² × ${hDisp}</span><span class="frac-den">7</span></span>`;
    document.getElementById("vRound").textContent = "";
    document.getElementById("vN").innerHTML = `<span class="label">V = </span><span class="frac"><span class="frac-num">${volNum}</span><span class="frac-den">${volDen}</span></span>${unitStr3} = ${mixedFrac(volNum, volDen)}${unitStr3}`;
    
  } else if (piMode === '3.14') {
    const csa = 2 * 3.14 * r * h;
    const vol = 3.14 * r * r * h;
    
    document.getElementById("aTrunc").innerHTML = `π ≈ 3.14: &nbsp; A = 2 × 3.14 × ${rDisp} × ${hDisp}`;
    document.getElementById("aRound").textContent = "";
    document.getElementById("aN").innerHTML = `<span class="label">A = </span>${fmt(csa, dp)}${unitStr2}`;

    document.getElementById("vTrunc").innerHTML = `π ≈ 3.14: &nbsp; V = 3.14 × ${rDisp}² × ${hDisp}`;
    document.getElementById("vRound").textContent = "";
    document.getElementById("vN").innerHTML = `<span class="label">V = </span>${fmt(vol, dp)}${unitStr3}`;
  }
}

unit = units[0];
update();
</script>
</body>
</html>
